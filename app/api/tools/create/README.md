# Create Tool

> Enables users to save a new custom workflow tool that agents can use.

**Endpoint:** `POST /api/tools/create`  
**Auth:** None

---

## Purpose

Creates a new tool definition (workflow) that can be assigned to agents. Users design workflows in the visual editor, and this endpoint persists them. The workflow is also transpiled into executable code that agents can run.

---

## Approach

We validate the request body using Zod, generate a unique slug-based ID, save the tool definition to storage, then transpile the workflow into executable JavaScript code. Transpilation failures are logged but don't fail the request - the workflow is still saved.

---

## Pseudocode

```
POST(request): NextResponse
├── Parse and validate body with Zod
├── Generate unique ID from name slug
│   ├── Slugify the name
│   └── **Call `ensureUniqueId()`** to avoid collisions
├── **Call `saveToolDefinition(id, data)`**
├── **Call `transpileWorkflowToTool()`** to generate code
├── **Call `saveToolExecutable()`** to save .js file
└── Return saved workflow with 201 status
```

---

## Input

| Field | Type | Required | Description |
|-------|------|----------|-------------|
| `id` | string | No | Custom ID (auto-generated if omitted) |
| `name` | string | Yes | Tool display name |
| `description` | string | No | What the tool does |
| `nodes` | Node[] | Yes | Workflow nodes |
| `edges` | Edge[] | Yes | Workflow connections |
| `apiKeys` | Record | No | API keys for nodes |

**Example Request:**
```json
{
  "name": "Email Summary",
  "description": "Summarizes email threads",
  "nodes": [
    { "id": "1", "type": "input", "data": { ... } }
  ],
  "edges": [
    { "source": "1", "target": "2" }
  ]
}
```

---

## Output

Returns the saved tool definition with generated ID.

```json
{
  "id": "email-summary",
  "name": "Email Summary",
  "description": "Summarizes email threads",
  "nodes": [...],
  "edges": [...]
}
```

---

## Consumers

| Consumer | Location | Usage |
|----------|----------|-------|
| Workflow Editor | `app/(pages)/tools/editor/page.tsx` | Save workflow button |

---

## Related Docs

- Tools Storage Service - `app/api/tools/services/storage.ts`
- Tools Transpiler Service - `app/api/tools/services/transpiler.ts`
- `/api/tools/list` - Lists all created tools
- `/api/tools/[toolId]/read` - Retrieves a specific tool

---

## Notes

- Transpilation failures are logged but don't fail the save operation - the tool definition is still persisted
- IDs are automatically slugified from names (e.g., "My Tool" → "my-tool")
- If an ID is provided but conflicts with an existing tool, a unique ID is generated by appending a random suffix
- The transpiled executable code is saved to `_tables/tools/{id}/tool.js` for runtime execution

---

## Future Improvements

- [ ] Add version history for tool definitions
- [ ] Validate workflow structure before saving
- [ ] Add duplicate tool detection
- [ ] Add tool import/export functionality
